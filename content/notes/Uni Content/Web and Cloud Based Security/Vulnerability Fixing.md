# Vulnerability Fixing

## Make a Test Controller

- Can test things without breaking anything else

## Output Variables and Terminate

- Use `var_dump` and `print_r`
- Use `die()` to stop anything else being processed

## SQL Injection

- Look for:
  - Database queries
  - Model access, SQL keywords
- Think about:
  - How are the queries being constructed
  - Where are parameters coming from
  - Are there direct queries
- How to fix it:
  - Ensure inputs into queries are safe and expected
  - Ensure queries are being constructed correctly
- Use `grep` to search through the code to find where to look:
  - Keywords: database, query, PDO, sql

## Information Exposure

- Look for:
  - Files exposed to the web that shouldn't be
  - Files or functions that are around that shouldn't be
- Think about:
  - What is being used and what isn't
  - If its not being used, why is it there?
  - Does it need to be used, but not publicly?
- How to fix it:
  - If theres no reason, get rid of it
  - If it doesn't need to be public, it shouldn't be public
- Using `grep`:
  - `.bak` files are backup files
  - `__find__` will output a list of all files in all folders, including hidden files

## Cross-Site Scripting/XSS

- Look for:
  - Inputs where data is stored and later displayed
  - Are there other places where HTML is combined with user input
  - Can any HTML characters be used in that data
  - Inputs which are outputs
  - Can you manipulate that HTML
- Think about:
  - What should acceptable input be
  - Should the output be encoded
- How to fix:
  - Reject or throw away invalid input
  - Encode HTML into normal characters
  - Strip HTML tags that shouldn't be allowed
- Will mostly be in templates and views:
  - Create/use a function to prepare unsafe input for display
  - Use everywhere its displayed in templates
  - Do validation on **input**:
    - Don't allow special characters in the first place
  - Do escaping on **output** not on **input**:
    - Preserve the original input in the database
  - Remove/Escape HTML where it's not needed:
    - E.g. a username#### 
  - Limit/Restrict HTML where it is needed
- Use libraries such as HTML purifier

![|400](https://remnote-user-data.s3.amazonaws.com/Iz5vTnOGIMTnJZKRiEfovS9_gXdmBTlEhRnT0YMzjaSF2JIwWzwNC7jgnSeVK0Jksuoay0GQffXxYiBOkAlIUK0EmQNqfY6vGKdaLV8_tv1x_PGI5Idl_ruA7v9tK0EB.png) 

User input being directly written out, allowing for XSS

![|400](https://remnote-user-data.s3.amazonaws.com/mcLkmS2F-H6q7hlV8KH4y_ENWN6SXzPjII3uWJxbKBUw03aR4uCXWPuxeem_gSIxJDsYgqwPb5bxcA1jj3Sc6j9fZCmMdxCwwOeAwokByi1OFN2TUYhAbUNYh66gDbqv.png)
### Example

![|400](https://remnote-user-data.s3.amazonaws.com/hVYLOLlHvVeP6Z5Wacx7UPNA4ocfHMcnvSPab8UmSvFa-d-0vrr1x03kGDtMkbCGt6Me8uouLpAr3uaWlr5NmNe_QVRAPLpKbiKk_0CfDet9RgrMXWk57KSeBwyL50Fr.png) 

h() escapes HTML and safe() limits HTML

![|400](https://remnote-user-data.s3.amazonaws.com/9ejLBL02lhOejGlopq8HozQja1j--lgeTKkFHQmYNGzvQc1mv8Y6zq0_tz0lkuKM0y4b9qwGd_zgOUXVQ51syu0Kqm8Rz0ESxKD8u3INm94p95oSurPUvutMuwJ498wQ.png) 

Turns to

![|400](https://remnote-user-data.s3.amazonaws.com/Xwx3CIkS9yVvsfQEFtzx_I-KRf1efa2fGDfnq_G1KIwsP_0NPF3FyzbsmDJrpJ5omTgiUvnWGhcKHUVUBAXSqW5Y-1LQgAdN69kxKjp7oWG8d18QmZ4QGhYw_Pu3b7oV.png)
