#orm #django #linkedin-learning

---
# Introduction to ORMs

Django uses an Object Relational Mapping system (ORM) to handle database communications and changes

You write class models that will then be transformed by migrations into database tables

![[Images/Pasted image 20240910140423.png|600]]

Each class is a database table and each class attribute is a column

We transform a model into a database table by creating migrations

Migrations have the step-by-step transformation that a database must do to apply the changes made in the code

The process of defining a model, creating a migration and applying the migration and changes to the database is the ORM's job

![[Images/Pasted image 20240910140745.png|600]]

# Creating your First Model

Make a new app

```
django-admin startapp notes
```

And remember to add the app to `settings.py`

📁`smartnotes\settings.py`
```python
# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',

    #apps
    'home',
    'notes',
]
```


Create a model for the notes

Each note is going to have a title, text and a creation date

📁`notes\models.py`
```python
from django.db import models
  
# Create your models here.
class Notes(models.Model):
    title = models.CharField(max_length=200)
    text = models.TextField()
    created = models.DateTimeField(auto_now_add=True)
```

Create the migrations

```
python manage.py makemigrations
```

This creates the file `0001_initial.py`

Every first migration of an app will be named like this

It is a list of operations that instructs the database what needs to be done

📁`notes\migrations\0001_initial.py`
```python
# Generated by Django 5.1 on 2024-08-29 20:06

from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='Notes',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=200)),
                ('text', models.TextField()),
                ('created', models.DateTimeField(auto_now_add=True)),
            ],
        ),
    ]
```


Apply the migrations

```
python manage.py migrate
```

# Using Admin for Data Creation and Manipulation

On the admin interface there will be no Notes model yet

We go to `notes\admin.py` to add which models will be displayed, and will therefore be modifiable through the Django admin interface


📁`notes\admin.py`
```python
from django.contrib import admin

from . import models

# Register your models here.
class NotesAdmin(admin.ModelAdmin):
    list_display = ('title',)

admin.site.register(models.Notes, NotesAdmin)
```

You can now create new Notes through the Django admin interface

# Using Django Shell for Creating and Querying Data

Django shell is a tool that can be used to query databases without using the admin interface

```
python .\manage.py shell
```

Example usage of Django shell

```python
>>> from notes.models import Notes
>>> mynote = Notes.objects.get(pk='1')
>>> mynote.title
'First Notes'
>>> mynote.text 
'Test'
>>> Notes.objects.all()
<QuerySet [<Notes: Notes object (1)>]>
>>> new_note = Notes.objects.create(title="test title", text="second note")
>>> Notes.objects.all()
<QuerySet [<Notes: Notes object (1)>, <Notes: Notes object (2)>]>
>>> Notes.objects.filter(title__startswith="test")
<QuerySet [<Notes: Notes object (2)>]>
>>> Notes.objects.filter(text__icontains='second')
<QuerySet [<Notes: Notes object (2)>]>
>>> Notes.objects.exclude(text__icontains='second')
<QuerySet [<Notes: Notes object (1)>]>
```